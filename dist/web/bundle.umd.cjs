!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";async function loadJsonFile(e){var t=e.replace(".csv","");if(jsonCache[t])return jsonCache[t];try{const e=await fetch(`/${t}.json`),a=await e.json();return jsonCache[t]=a,a}catch(a){return console.error("Error loading JSON:",a),null}}async function updateDescription(e){const{element:t,detail:a}=e;if(!a)return;const{rowId:n,csvFilename:s}=a;if(console.log("updateDescription",a),!n)return;if(!s)return;const o=await loadJsonFile(s);if(!o)return void console.error("No description available: CSV file not found. This is caused by missing CSV file, failed to convert to JSON, or failed to load from cache.");const r=o.find((e=>e.id===n));if(!r)return void console.error("No description available: Row not found");t.querySelectorAll(".description-field").forEach((e=>{e.textContent=r[e.dataset.columnName]}))}function initValidator(e,t){const a=e.name,n=global.schemas[a];console.log(a,n),n?e.addEventListener("input",(e=>{console.log(e);const a=validate(e.target.value,n);a.valid?(e.target.classList.remove("invalid"),t&&(t.textContent="")):(e.target.classList.add("invalid"),t&&(t.textContent=a.message))})):console.error(`No schema found for ${a}`)}function validate(e,t){var a;try{t.parse(e);return{valid:!0,message:""}}catch(n){return{valid:!1,message:(null==(a=error.errors[0])?void 0:a.message)||"入力が無効です"}}}function dispatchWrappedEvent(e,t){const a=e.target;if(a.classList.contains("event-wrapper"))return;const n={...a.dataset},s=new CustomEvent(t,{bubbles:!0,detail:n});document.dispatchEvent(s)}globalThis.PARAM_TYPES={Bool:"Bool",Number:"Number",String:"String",Object:"Object",Array:"Array"},globalThis.ROS_EVENTS={Publish:"Publish",Subscribe:"Subscribe",SubscribedValue:"SubscribedValue",Param:"Param",ParamSet:"ParamSet",ParamUpdated:"ParamUpdated"},globalThis.Utils={EvalGetValue:function(value,key){let v;return eval("v = value"+key),v},EvalSetValue:function(value,key,newValue){let v=structuredClone(value);return eval("v"+key+" = newValue"),v},dictFullPathAdd:function(e,t,a){let n=structuredClone(e),s=n;t.startsWith(".")&&(t=t.slice(1));const o=t.split(".");return o.forEach(((e,t)=>{const n=e.match(/(\w+)\[(\d+)\]/);if(n){const[e,r,c]=n;s[r]||(s[r]=[]),t===o.length-1?s[r][c]=a:(s[r][c]||(s[r][c]={}),s=s[r][c])}else t===o.length-1?s[e]=a:(s[e]||(s[e]={}),s=s[e])})),n}},document.addEventListener("DOMContentLoaded",(async()=>{document.addEventListener(ROS_EVENTS.Publish,(async e=>{const{name:t,type:a,value:n}=e.detail;console.debug(`[CA] Publish: ${t} (${a}, ${n})`),eel.ros_publish(t,a,n)})),document.addEventListener(ROS_EVENTS.Subscribe,(async e=>{const{name:t,type:a}=e.detail;console.debug(`[CA] Subscribe: ${t} (${a})`),eel.ros_subscribe(t,a)})),document.addEventListener(ROS_EVENTS.Param,(async e=>{const{name:t}=e.detail;console.debug(`[CA] Param: ${t}`),eel.ros_register_param(t)})),document.addEventListener(ROS_EVENTS.ParamSet,(async e=>{const{name:t,type:a,value:n}=e.detail;console.debug(`[CA] ParamSet: ${t} (${a}, ${n})`),eel.ros_set_param(t,a,n)})),eel.health(document.title)})),globalThis.ROSInterface={getParam:async function(e){return await eel.ros_get_param(e)}},globalThis.jsonCache={},document.addEventListener("DOMContentLoaded",(e=>{var t=document.getElementsByClassName("description");for(const a of t){domUpdateHelper.registerCallback(a,updateDescription);const e=a.dataset.eventName;document.addEventListener(e,(e=>{const t={detail:e.detail};domUpdateHelper.executeCallbacks(a,t)}))}})),document.addEventListener("DOMContentLoaded",(e=>{var t=document.getElementsByClassName("validator-wrapper");for(const a of t){const e=a.querySelector("input"),t=a.querySelector(".validation-error");e?initValidator(e,t):console.error("No input element found in validator-wrapper",a)}})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementsByClassName("click-wrapper");for(const n of e){const e=n.dataset.eventName;n.addEventListener("click",(t=>dispatchWrappedEvent(t,e)))}const t=document.getElementsByClassName("hover-wrapper");for(const n of t){const e=n.dataset.eventName;n.addEventListener("mouseover",(t=>dispatchWrappedEvent(t,e)))}const a=document.getElementsByClassName("leave-wrapper");for(const n of a){const e=n.dataset.eventName;n.addEventListener("mouseout",(t=>dispatchWrappedEvent(t,e)))}})),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementsByClassName("rosparam");for(const t of e){console.assert(null!==t.getAttribute("name"),"Parameterのname属性が必要です.");const e=t.getAttribute("name"),a=new CustomEvent(ROS_EVENTS.Param,{detail:{name:e}});if(document.dispatchEvent(a),!t.hasAttribute("update-custom")){if(domUpdateHelper.registerCallback(t,domUpdateHelper.updateElement),"DIV"===t.tagName){const a=t.querySelectorAll("input");for(const t of a)t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=t.currentTarget.getAttribute("data-key"),s=await ROSInterface.getParam(e),o=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Object,value:Utils.EvalSetValue(s,n,a)}});document.dispatchEvent(o)}))}"SELECT"===t.tagName&&t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Number,value:a}});document.dispatchEvent(n)})),"INPUT"===t.tagName&&("checkbox"===t.type?t.addEventListener("change",(async t=>{const a=t.currentTarget.checked,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Bool,value:a}});document.dispatchEvent(n)})):"radio"===t.type?t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Number,value:a}});document.dispatchEvent(n)})):"text"===t.type?t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.String,value:a}});document.dispatchEvent(n)})):t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Number,value:a}});document.dispatchEvent(n)})))}}document.addEventListener(ROS_EVENTS.ParamUpdated,(async e=>{const{name:t,type:a,value:n}=e.detail;document.getElementsByName(t).forEach((e=>{domUpdateHelper.executeCallbacks(e,{type:a,value:n})}))}))})),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementsByClassName("publish");for(const t of e){const e=t.getAttribute("name");console.assert(e,"Publisherのname属性が必要です");const a=t.getAttribute("m-type");if(console.assert(a,"Publisherのext属性が必要です"),console.assert("DIV"===t.tagName,"PublisherはDIVタグである必要があります"),"DIV"!==t.tagName)continue;const n=t.querySelector("button");console.assert(n,"Publisherはbuttonタグを含む必要があります");const s=t.querySelectorAll("input");console.assert(s.length>0,"Publisherはinputタグを含む必要があります"),n.addEventListener("click",(async t=>{let n={};s.forEach((e=>{const t=e.getAttribute("ext");var a;t&&(a="checkbox"==e.type?e.checked:"number"==e.type||"radio"==e.type?Number(e.value):e.value,n=Utils.dictFullPathAdd(n,t,a))}));const o=new CustomEvent(ROS_EVENTS.Publish,{detail:{name:e,type:a,value:n}});document.dispatchEvent(o)}))}})),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementsByClassName("subscribe");for(const t of e){const e=t.getAttribute("name");console.assert(e,"Subscriberのname属性が必要です.");const a=t.getAttribute("m-type");if(console.assert(a,"Subscriberのm-type属性が必要です."),console.assert("DIV"===t.tagName,"SubscriberはDIVタグである必要があります."),"DIV"!==t.tagName)continue;const n=new CustomEvent(ROS_EVENTS.Subscribe,{detail:{name:e,type:a}});document.dispatchEvent(n),t.hasAttribute("update-custom")||domUpdateHelper.registerCallback(t,domUpdateHelper.updateElement)}document.addEventListener(ROS_EVENTS.SubscribedValue,(async e=>{const{name:t,value:a}=e.detail;document.getElementsByName(t).forEach((e=>{domUpdateHelper.executeCallbacks(e,{value:a})}))}))}));class DOMUpdateHelper{constructor(){this.updateCallbacks=new WeakMap}registerCallback(e,t){this.updateCallbacks.has(e)?this.updateCallbacks.get(e).push(t):this.updateCallbacks.set(e,[t])}executeCallbacks(e,t){this.updateCallbacks.has(e)&&this.updateCallbacks.get(e).forEach((a=>{a({element:e,...t})}))}updateElement(e,t){switch(e.tagName){case"DIV":updateDivElement(e,t);break;case"SELECT":updateSelectElement(e,t);break;case"INPUT":updateInputElement(e,t);break;case"IMG":updateImageElement(e,t);default:throw new Error(`Unsupported element type: ${e.tagName}`)}}updateDivElement(e,t){e.setAttribute("data-value",t);const a=e.children;for(const n of a)n.hasAttribute("ext")&&updateElement(n,Utils.EvalGetValue(t,n.getAttribute("ext")))}updateInputElement(e,t){"checkbox"!==e.type?"radio"!==e.type?e.value=t:e.checked=e.value===t:e.checked=t}updateSelectElement(e,t){const a=e.querySelectorAll("option");for(let n=0;n<a.length;n++)a[n].selected=a[n].value===t}updateImageElement(e,t){e.src=t}}globalThis.domUpdateHelper=new DOMUpdateHelper,globalThis.eelEntrypoints={updateSubscribedValue:function(e,t){const a=new CustomEvent(ROS_EVENTS.SubscribedValue,{detail:{name:e,value:t}});document.dispatchEvent(a)},updateParam:function(e,t,a){const n=new CustomEvent(ROS_EVENTS.ParamUpdated,{detail:{name:e,type:t,value:a}});document.dispatchEvent(n)},health:function(e){return console.log("[CA] Python -> JS: OK"),document.title+": "+e}},eel.expose(eelEntrypoints.updateSubscribedValue,"updateSubscribedValue"),eel.expose(eelEntrypoints.updateParam,"updateParam"),eel.expose(eelEntrypoints.health,"health"),window.addEventListener("unload",(async e=>{for(const t of publishButtons)eel.ros_unpublish(t.getAttribute("name"));for(const t of subscribeElements)eel.ros_unsubscribe(t.getAttribute("name"));for(const t of paramElements)eel.ros_unregister_param(t.getAttribute("name"))}))}));
//# sourceMappingURL=bundle.umd.cjs.map
