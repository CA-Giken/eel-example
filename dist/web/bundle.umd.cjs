!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";async function loadJsonFile(e){var t=e.replace(".csv","");if(global.jsonCache[t])return global.jsonCache[t];try{const e=await fetch(`/${t}.json`),a=await e.json();return global.jsonCache[t]=a,a}catch(a){return console.error("Error loading JSON:",a),null}}async function updateDescription(e){const{element:t,detail:a}=e;if(!a)return;const{rowId:n,csvFilename:r}=a;if(!n)return;if(!r)return;const s=await loadJsonFile(r);if(!s)return void console.error("No description available: CSV file not found. This is caused by missing CSV file, failed to convert to JSON, or failed to load from cache.");const o=s.find((e=>e.id===n));if(!o)return void console.error("No description available: Row not found");t.querySelectorAll(".description-field").forEach((e=>{e.textContent=o[e.dataset.columnName]}))}function initValidator(e,t){const a=e.name,n=global.schemas[a];console.log(a,n),n?e.addEventListener("input",(e=>{console.log(e);const a=validate(e.target.value,n);a.valid?(e.target.classList.remove("invalid"),t&&(t.textContent="")):(e.target.classList.add("invalid"),t&&(t.textContent=a.message))})):console.error(`No schema found for ${a}`)}function validate(e,t){var a;try{t.parse(e);return{valid:!0,message:""}}catch(n){return{valid:!1,message:(null==(a=error.errors[0])?void 0:a.message)||"入力が無効です"}}}globalThis.MSG_TYPES={Bool:"Bool:std_msgs",Int32:"Int32:std_msgs",Int64:"Int64:std_msgs",Float32:"Float32:std_msgs",Float64:"Float64:std_msgs",String:"String:std_msgs",Transform:"Transform:geometry_msgs",Pose:"Pose:geometry_msgs",Image:"Image:sensor_mags"},globalThis.PARAM_TYPES={Bool:"Bool",Number:"Number",String:"String",Object:"Object",Array:"Array"},globalThis.ROS_EVENTS={Publish:"Publish",Subscribe:"Subscribe",SubscribedValue:"SubscribedValue",Param:"Param",ParamSet:"ParamSet",ParamUpdated:"ParamUpdated"},globalThis.jsonCache={},document.addEventListener("DOMContentLoaded",(e=>{var t=document.getElementsByClassName("description");for(const a of t)domUpdateHelper.registerCallback(a,updateDescription);document.addEventListener("UIDescriptionHover",(e=>{var t=document.getElementsByClassName("description");for(const a of t)domUpdateHelper.executeCallbacks(a,{detail:e.detail})}))})),document.addEventListener("DOMContentLoaded",(e=>{var t=document.getElementsByClassName("validator-wrapper");for(const a of t){const e=a.querySelector("input"),t=a.querySelector(".validation-error");e?initValidator(e,t):console.error("No input element found in validator-wrapper",a)}})),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementsByClassName("rosparam");for(const t of e){console.assert(null!==t.getAttribute("name"),"Parameterのname属性が必要です.");const e=t.getAttribute("name"),a=new CustomEvent(ROS_EVENTS.Param,{detail:{name:e}});if(document.dispatchEvent(a),!t.hasAttribute("update-custom")){if(domUpdateHelper.registerCallback(t,domUpdateHelper.updateElement),"DIV"===t.tagName){const a=t.querySelectorAll("input");for(const t of a)t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=t.currentTarget.getAttribute("data-key"),r=await ROSInterface.getParam(e),s=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Object,value:Utils.EvalSetValue(r,n,a)}});document.dispatchEvent(s)}))}"SELECT"===t.tagName&&t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Number,value:a}});document.dispatchEvent(n)})),"INPUT"===t.tagName&&("checkbox"===t.type?t.addEventListener("change",(async t=>{const a=t.currentTarget.checked,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Bool,value:a}});document.dispatchEvent(n)})):"radio"===t.type?t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Number,value:a}});document.dispatchEvent(n)})):"text"===t.type?t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.String,value:a}});document.dispatchEvent(n)})):t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Number,value:a}});document.dispatchEvent(n)})))}}document.addEventListener(ROS_EVENTS.ParamUpdated,(async e=>{const{name:t,type:a,value:n}=e.detail;document.getElementsByName(t).forEach((e=>{domUpdateHelper.executeCallbacks(e,{type:a,value:n})}))}))})),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementsByClassName("publish");for(const t of e)console.assert("BUTTON"===t.tagName,"PublisherはButtonエレメントにのみ限定する"),console.assert(null!==t.getAttribute("name"),"Publisherのname属性が必要です."),console.assert(t.getAttribute("data-rtype")in MSG_TYPES,`Publisherのdata-rtypeが不正です. ${t.getAttribute("data-rtype")}`),"BUTTON"===t.tagName&&t.addEventListener("click",(async e=>{const t=e.currentTarget.getAttribute("name"),a=MSG_TYPES[e.currentTarget.getAttribute("data-rtype")],n=e.currentTarget.getAttribute("value"),r=new CustomEvent(ROS_EVENTS.Publish,{detail:{name:t,type:a,value:n}});document.dispatchEvent(r)}))})),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementsByClassName("subscribe");for(const t of e){console.assert(null!==t.getAttribute("name"),"Subscriberのname属性が必要です."),console.assert(t.getAttribute("data-rtype")in MSG_TYPES,`Subscriberのdata-rtypeが不正です. ${t.getAttribute("data-rtype")}`);const e=t.getAttribute("name"),a=MSG_TYPES[t.getAttribute("data-rtype")],n=new CustomEvent(ROS_EVENTS.Subscribe,{detail:{name:e,type:a}});document.dispatchEvent(n),t.hasAttribute("update-custom")||domUpdateHelper.registerCallback(t,domUpdateHelper.updateElement)}document.addEventListener(ROS_EVENTS.SubscribedValue,(async e=>{const{name:t,type:a,value:n}=e.detail;document.getElementsByName(t).forEach((e=>{domUpdateHelper.executeCallbacks(e,{type:a,value:n})}))}))}));class DOMUpdateHelper{constructor(){this.updateCallbacks=new WeakMap}registerCallback(e,t){this.updateCallbacks.has(e)?this.updateCallbacks.get(e).push(t):this.updateCallbacks.set(e,[t])}executeCallbacks(e,t){this.updateCallbacks.has(e)&&this.updateCallbacks.get(e).forEach((a=>{a({element:e,...t})}))}updateElement(e,t){switch(e.tagName){case"DIV":updateDivElement(e,t);break;case"SELECT":updateSelectElement(e,t);break;case"INPUT":updateInputElement(e,t);break;case"IMG":updateImageElement(e,t);default:throw new Error(`Unsupported element type: ${e.tagName}`)}}updateDivElement(e,t){e.setAttribute("data-value",t);const a=e.querySelectorAll("input");for(const n of a)updateInputElement(n,Utils.EvalGetValue(t,n.getAttribute("data-key")))}updateInputElement(e,t){"checkbox"!==e.type?"radio"!==e.type?e.value=t:e.checked=e.value===t:e.checked=t}updateSelectElement(e,t){const a=e.querySelectorAll("option");for(let n=0;n<a.length;n++)a[n].selected=a[n].value===t}updateImageElement(e,t){e.src=t}}function to_jsvalue(e,t){if(e===MSG_TYPES.Float32)return parseFloat(t);if(e===MSG_TYPES.Float64)return parseFloat(t);if(e===MSG_TYPES.Int32)return parseInt(t);if(e===MSG_TYPES.Int64)return parseInt(t);if(e===MSG_TYPES.String)return t;if(e===MSG_TYPES.Bool)return"True"===t;if(e===MSG_TYPES.Transform)return t.map(parseFloat);if(e===MSG_TYPES.Pose)return t.map(parseFloat);if(e===MSG_TYPES.Image)return"data:image/jpeg;base64,"+t;if(e===PARAM_TYPES.Bool)return"True"===t;if(e===PARAM_TYPES.Number)return parseFloat(t);if(e===PARAM_TYPES.String)return t;throw new Error("Unknown type: "+e)}globalThis.domUpdateHelper=new DOMUpdateHelper,document.addEventListener("DOMContentLoaded",(async()=>{document.addEventListener(ROS_EVENTS.Publish,(async e=>{const{name:t,type:a,value:n}=e.detail;eel.ros_publish(t,a,n)})),document.addEventListener(ROS_EVENTS.Subscribe,(async e=>{const{name:t,type:a}=e.detail;eel.ros_subscribe(t,a)})),document.addEventListener(ROS_EVENTS.Param,(async e=>{const{name:t}=e.detail;eel.ros_register_param(t)})),document.addEventListener(ROS_EVENTS.ParamSet,(async e=>{const{name:t,type:a,value:n}=e.detail;eel.ros_set_param(t,a,n)})),eel.expose((function(e,t,a){const n=new CustomEvent(ROS_EVENTS.SubscribedValue,{detail:{name:e,type:t,value:to_jsvalue(t,a)}});document.dispatchEvent(n)})),eel.expose((function(e,t,a){const n=new CustomEvent(ROS_EVENTS.ParamUpdated,{detail:{name:e,type:t,value:to_jsvalue(t,a)}});document.dispatchEvent(n)})),eel.health(document.title),eel.expose((function(e){return console.log("[CA] Python -> JS: OK"),document.title+": "+e}))})),globalThis.ROSInterface={getParam:async function(e){return await eel.ros_get_param(e)}},window.addEventListener("unload",(async e=>{for(const t of publishButtons)eel.ros_unpublish(t.getAttribute("name"));for(const t of subscribeElements)eel.ros_unsubscribe(t.getAttribute("name"));for(const t of paramElements)eel.ros_unregister_param(t.getAttribute("name"))})),globalThis.Utils={EvalGetValue:function(value,key){let v;return eval("v = value"+key),v},EvalSetValue:function(value,key,newValue){let v=structuredClone(value);return eval("v"+key+" = newValue"),v}}}));
//# sourceMappingURL=bundle.umd.cjs.map
